name: Deploy Frontend Bida

on:
  push:
    branches:
      - main

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Deploy to Server via SSH
        uses: appleboy/ssh-action@master
        with:
          host: ${{ secrets.REMOTE_HOST }}
          username: ${{ secrets.REMOTE_USER }}
          key: ${{ secrets.SSH_PRIVATE_KEY }}
          port: ${{ secrets.REMOTE_PORT }}
          script: |
            cd ${{ secrets.TARGET_DIR }}
            set -e  # CỰC KỲ QUAN TRỌNG: Dừng ngay nếu có bất kỳ lệnh nào lỗi

            git fetch --all
            git reset --hard origin/main

            npm install

            # Xóa thư mục dist cũ để đảm bảo nếu build lỗi thì không dùng lại bản cũ
            rm -rf dist 

            # Lệnh này nếu lỗi (do TS) thì script sẽ dừng và GitHub báo Đỏ (Fail)
            npm run build

            echo "Build Frontend hoàn tất và thư mục dist đã được cập nhật!"
